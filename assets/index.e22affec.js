var U=Object.defineProperty;var N=(n,t,e)=>t in n?U(n,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):n[t]=e;var F=(n,t,e)=>(N(n,typeof t!="symbol"?t+"":t,e),e);import{d as I,f as L,g as $,v as V,r as v,o as R,A as P,H as h,B as r,C as _,D,ag as B,c as k,O as T,N as O,ab as x}from"./vendor.d575ceee.js";import{_ as G}from"./_plugin-vue_export-helper.cdc0426e.js";var d=(n=>(n.CF_TRUE_COLOR="CF_TRUE_COLOR",n.CF_TRUE_COLOR_ALPHA="CF_TRUE_COLOR_ALPHA",n.CF_TRUE_COLOR_CHROMA="CF_TRUE_COLOR_CHROMA",n.CF_INDEXED_1_BIT="CF_INDEXED_1_BIT",n.CF_INDEXED_2_BIT="CF_INDEXED_2_BIT",n.CF_INDEXED_4_BIT="CF_INDEXED_4_BIT",n.CF_INDEXED_8_BIT="CF_INDEXED_8_BIT",n.CF_ALPHA_1_BIT="CF_ALPHA_1_BIT",n.CF_ALPHA_2_BIT="CF_ALPHA_2_BIT",n.CF_ALPHA_4_BIT="CF_ALPHA_4_BIT",n.CF_ALPHA_8_BIT="CF_ALPHA_8_BIT",n.CF_RAW="CF_RAW",n.CF_RAW_ALPHA="CF_RAW_ALPHA",n.CF_RAW_CHROMA="CF_RAW_CHROMA",n.CF_RGB565A8="CF_RGB565A8",n))(d||{}),c=(n=>(n.C="C",n.BIN="BIN",n.PYTHON="PYTHON",n))(c||{});const W={isTrueColor(n){return["CF_TRUE_COLOR","CF_TRUE_COLOR_ALPHA","CF_TRUE_COLOR_CHROMA"].includes(n)}};class H{static rgb565(t,e,o){return(t&248)<<8|(e&252)<<3|o>>3}static rgb888(t,e,o){return t<<16|e<<8|o}static rgba8888(t,e,o,a){return a<<24|t<<16|e<<8|o}}class z{constructor(t,e){F(this,"canvas");F(this,"ctx");F(this,"imageData");F(this,"width");F(this,"height");F(this,"options");this.canvas=document.createElement("canvas"),this.ctx=this.canvas.getContext("2d"),this.width=e.overrideWidth||t.width,this.height=e.overrideHeight||t.height,this.canvas.width=this.width,this.canvas.height=this.height,this.ctx.drawImage(t,0,0,this.width,this.height),this.imageData=this.ctx.getImageData(0,0,this.width,this.height),this.options=e}convertToC(){const t=this.processPixels(),e=this.generateHeaderComment(),o=this.generateDataArray(t),a=this.generateDescriptor();return`${e}
${o}
${a}`}convertToBinary(){const t=this.processPixels(),e=this.generateBinaryHeader(),o=new Uint8Array(e.length+t.length);return o.set(e),o.set(t,e.length),o}convertToPython(){const t=this.processPixels(),e=this.generatePythonHeaderComment(),o=this.generatePythonDataArray(t),a=this.generatePythonDescriptor();return`${e}
${o}
${a}`}processPixels(){const{cf:t,dith:e}=this.options,o=this.imageData.data,a=[];for(let u=0;u<o.length;u+=4){const p=o[u],w=o[u+1],E=o[u+2],s=o[u+3];if(W.isTrueColor(t))switch(t){case d.CF_TRUE_COLOR:a.push(H.rgb565(p,w,E));break;case d.CF_TRUE_COLOR_ALPHA:a.push(H.rgba8888(p,w,E,s));break}}return new Uint8Array(a)}generateHeaderComment(){return`/*
 * Generated by LVGL Image Converter
 * Width: ${this.width}
 * Height: ${this.height}
 * Color Format: ${this.options.cf}
 */`}generatePythonHeaderComment(){return`"""
Generated by LVGL Image Converter
Width: ${this.width}
Height: ${this.height}
Color Format: ${this.options.cf}
"""

import lvgl as lv
`}generateDataArray(t){const e=[];e.push(`const uint8_t ${this.options.outName}_map[] = {`);for(let a=0;a<t.length;a+=16){const u=Array.from(t.slice(a,a+16)).map(p=>"0x"+p.toString(16).padStart(2,"0")).join(", ");e.push(`    ${u}${a+16<t.length?",":""}`)}return e.push("};"),e.join(`
`)}generatePythonDataArray(t){const e=[];e.push(`${this.options.outName}_map = bytes([`);for(let a=0;a<t.length;a+=16){const u=Array.from(t.slice(a,a+16)).map(p=>"0x"+p.toString(16).padStart(2,"0")).join(", ");e.push(`    ${u}${a+16<t.length?",":""}`)}return e.push("])"),e.join(`
`)}generateDescriptor(){return`
const lv_img_dsc_t ${this.options.outName} = {
    .header.cf = ${this.options.cf},
    .header.always_zero = 0,
    .header.reserved = 0,
    .header.w = ${this.width},
    .header.h = ${this.height},
    .data_size = ${this.width*this.height*this.getBytesPerPixel()},
    .data = ${this.options.outName}_map,
};`}generatePythonDescriptor(){return`
${this.options.outName} = lv.img_dsc_t({
    'header': {
        'cf': lv.img.CF.${this.options.cf},
        'always_zero': 0,
        'reserved': 0,
        'w': ${this.width},
        'h': ${this.height}
    },
    'data_size': ${this.width*this.height*this.getBytesPerPixel()},
    'data': ${this.options.outName}_map
})`}generateBinaryHeader(){const t=new Uint8Array(8),e=new DataView(t.buffer);return e.setUint32(0,1280722756,!this.options.swapEndian),e.setUint16(4,this.width,!this.options.swapEndian),e.setUint16(6,this.height,!this.options.swapEndian),t}getBytesPerPixel(){switch(this.options.cf){case d.CF_TRUE_COLOR:return 2;case d.CF_TRUE_COLOR_ALPHA:return 4;default:return 1}}convert(){switch(this.options.outputFormat){case c.C:return this.convertToC();case c.PYTHON:return this.convertToPython();case c.BIN:return this.convertToBinary();default:throw new Error("Unsupported output format")}}}async function X(n,t){return new z(n,t).convert()}const j={class:"image-converter"},S={class:"converter-container"},Y={key:0,class:"preview-section"},K={class:"preview-container"},q=["src"],J={key:0,class:"image-info"},Q=I({__name:"index",setup(n){const t=L(null),e=L(""),o=L(null),a=$({cf:d.CF_TRUE_COLOR,dith:!1,outputFormat:c.C,binaryFormat:d.CF_TRUE_COLOR,swapEndian:!1,outName:"img_converted",colorDepth:"16"}),u=V(()=>[d.CF_TRUE_COLOR,d.CF_TRUE_COLOR_ALPHA].includes(a.cf)),p=s=>{t.value=s.raw,e.value=URL.createObjectURL(s.raw);const i=new Image;i.onload=()=>{o.value={width:i.width,height:i.height,size:s.raw.size}},i.src=e.value},w=s=>s<1024?s+" B":s<1048576?(s/1024).toFixed(2)+" KB":(s/1048576).toFixed(2)+" MB",E=async()=>{try{if(!t.value){x.warning("\u8BF7\u5148\u9009\u62E9\u56FE\u7247");return}const s=new Image,i=new Promise((f,y)=>{s.onload=()=>f(s),s.onerror=y});s.src=e.value,await i;const b=await X(s,{cf:a.cf,dith:a.dith,outputFormat:a.outputFormat,binaryFormat:a.binaryFormat,swapEndian:a.swapEndian,outName:a.outName}),l=f=>{switch(f){case c.C:return"c";case c.PYTHON:return"py";case c.BIN:return"bin";default:return"txt"}},g=new Blob([b],{type:a.outputFormat===c.BIN?"application/octet-stream":"text/plain"}),C=URL.createObjectURL(g),A=document.createElement("a");A.href=C,A.download=`${a.outName}.${l(a.outputFormat)}`,A.click(),URL.revokeObjectURL(C),x.success("\u56FE\u7247\u8F6C\u6362\u6210\u529F")}catch(s){console.error("\u56FE\u7247\u8F6C\u6362\u5931\u8D25:",s),x.error("\u56FE\u7247\u8F6C\u6362\u5931\u8D25: "+s.message)}};return(s,i)=>{const b=v("el-upload"),l=v("el-option"),g=v("el-select"),C=v("el-form-item"),A=v("el-switch"),f=v("el-button"),y=v("el-form");return R(),P("div",j,[h("div",S,[r(b,{class:"image-upload",drag:"","auto-upload":!1,"on-change":p,accept:"image/*"},{default:_(()=>[...i[4]||(i[4]=[h("i",{class:"el-icon-upload"},null,-1),h("div",{class:"el-upload__text"},[D("\u62D6\u62FD\u56FE\u7247\u5230\u6B64\u5904\u6216 "),h("em",null,"\u70B9\u51FB\u4E0A\u4F20")],-1)])]),_:1}),r(y,{model:a,"label-width":"120px",class:"settings-form"},{default:_(()=>[r(C,{label:"\u989C\u8272\u683C\u5F0F"},{default:_(()=>[r(g,{modelValue:a.cf,"onUpdate:modelValue":i[0]||(i[0]=m=>a.cf=m)},{default:_(()=>[r(l,{label:"True Color",value:"true_color"}),r(l,{label:"True Color Alpha",value:"true_color_alpha"}),r(l,{label:"Indexed 1 (1 bit)",value:"indexed_1"}),r(l,{label:"Indexed 2 (2 bit)",value:"indexed_2"}),r(l,{label:"Indexed 4 (4 bit)",value:"indexed_4"}),r(l,{label:"Indexed 8 (8 bit)",value:"indexed_8"})]),_:1},8,["modelValue"])]),_:1}),r(C,{label:"\u6296\u52A8"},{default:_(()=>[r(A,{modelValue:a.dith,"onUpdate:modelValue":i[1]||(i[1]=m=>a.dith=m)},null,8,["modelValue"])]),_:1}),r(C,{label:"\u8F93\u51FA\u683C\u5F0F"},{default:_(()=>[r(g,{modelValue:a.outputFormat,"onUpdate:modelValue":i[2]||(i[2]=m=>a.outputFormat=m)},{default:_(()=>[r(l,{label:"C \u6570\u7EC4",value:B(c).C},null,8,["value"]),r(l,{label:"Python \u6570\u7EC4",value:B(c).PYTHON},null,8,["value"]),r(l,{label:"\u4E8C\u8FDB\u5236\u6587\u4EF6",value:B(c).BIN},null,8,["value"])]),_:1},8,["modelValue"])]),_:1}),u.value?(R(),k(C,{key:0,label:"\u989C\u8272\u6DF1\u5EA6"},{default:_(()=>[r(g,{modelValue:a.colorDepth,"onUpdate:modelValue":i[3]||(i[3]=m=>a.colorDepth=m)},{default:_(()=>[r(l,{label:"16 bit (RGB565)",value:"16"}),r(l,{label:"24 bit (RGB888)",value:"24"}),r(l,{label:"32 bit (ARGB8888)",value:"32"})]),_:1},8,["modelValue"])]),_:1})):T("",!0),r(C,null,{default:_(()=>[r(f,{type:"primary",onClick:E,disabled:!t.value},{default:_(()=>[...i[5]||(i[5]=[D(" \u8F6C\u6362\u56FE\u7247 ",-1)])]),_:1},8,["disabled"])]),_:1})]),_:1},8,["model"]),e.value?(R(),P("div",Y,[i[6]||(i[6]=h("h3",null,"\u9884\u89C8",-1)),h("div",K,[h("img",{src:e.value,alt:"Preview"},null,8,q),o.value?(R(),P("div",J,[h("p",null,"\u5C3A\u5BF8: "+O(o.value.width)+" x "+O(o.value.height)+" px",1),h("p",null,"\u6587\u4EF6\u5927\u5C0F: "+O(w(o.value.size)),1)])):T("",!0)])])):T("",!0)])])}}});const te=G(Q,[["__scopeId","data-v-2935fade"]]);export{te as default};
